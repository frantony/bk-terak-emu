
Это, пока еще сугубо тестовая новая версия эмулятора
(альфа или около этого) -- ошибок следует ожидать много...

Сборка: make all.

Компилятор (Win32): gcc/MinGW (build 20030504) + SDL-1.2.7

ОСНОВНЫЕ ИЗМЕНЕНИЯ
(по сравнению с bk-terak-emu.2005.05.12.tar):

- Новая реализация процессора ("cpu.c").
Там же теперь инициализация (cpu_init) и обработка прерываний (cpu_service)

- По заверщении выводится статистика по процессорному времени и выполненным
инструкциям.

- Инициализация устройств через device_install (реализовано в access.c).
Структура pdp_qmap теперь в defines.h и немного изменена.

- Установка перехвата контрольных точек (install_cp) в main.c

- Новая система вывода сообщений (через logf)

- По умолчанию включена трассировка EMT и TRAP (в main.c)

- Несколько новых опций:

	-k FILE:
	времено перенаправить из FILE ввод через EMT 6
	
	-d FILE:
	копировать в FILE вывод через EMT 16/20

	-x FILE:
	загрузить и запустить ленточный файл FILE	(см. ф-цию launch в main.c)

- Полностью по новому сделан звук!! (sdl_sound.c).

- Все, SDL-специфичное связанное со вводом перенесено в sdl_input.c

- Немного изменена клавиатура - см. kbd.h и sdl_input.c

- Все, связанное с fake_tape и fake_disk, перенесено в sim_tape и sim_disk соответственно.

- Мелочи:
многие функции прототипизированы, все ненужное вынесено из defines.h, кое-что туда
добавлено, все что можно декларировано static, etc.

ЧТО ЕЩЕ ЖЕЛАТЕЛЬНО СДЕЛАТЬ:

- Как следует разобраться с экраном (scr.c), попытаться оптимизировать регенерацию.
Вынести, все, относящнееся к SDL в sdl_video.c

- Доделать эмуляцию чтения ленты через прямой перехват EMT 36

- Перевести весь вывод на logf, упорядочить систему диагностики.

- Доделать интерфейс устройств. Желательно разделить dev_init на:
собственно init (выполняется однажды в начале) и reset (каждый
раз при сбросе шины). Реализовать в access.c трассировку обращения
к устройствам.

- Реализовать джойстик (или джойстики?)

- В процессоре еще кое-что можно улучшить. (Возможно, добавить EIS?)
Проверить тайминг инструкций (в эмуляторе Калмыкова значения немного другие...)

- Попробывать вместо ui.c реализовать полноэкранный монитор-отладчик.
Было б здорово, но...

- Наконец, заставить работать Terak и посмотреть, что это такое. ;)

Ну и, разумеется, добить все ошибки...

05.12.2005
Денис (gayev@rsl.ru)

